# ğŸš€ CI/CD con AWS CodePipeline

Este repositorio implementa un flujo de integraciÃ³n y despliegue continuo (CI/CD) en AWS utilizando CodePipeline, CodeBuild, ECR, Lambda y CloudFormation.

## ğŸ“Œ Flujo del CI/CD

### 1ï¸âƒ£ CodePipeline detecta cambios en GitHub
Cuando realizas un `git push`, AWS CodePipeline detecta el cambio en la rama `master` gracias a la configuraciÃ³n en `ci-cd.yml`.

### 2ï¸âƒ£ Descarga del cÃ³digo desde GitHub
ğŸ“Œ **Archivo:** `cloudformation/ci-cd.yml`
- Descarga el cÃ³digo desde el repositorio de GitHub.
- Almacena el cÃ³digo en un **S3 Artifact Bucket**.
- Pasa el cÃ³digo como entrada al siguiente paso (**CodeBuild**).

### 3ï¸âƒ£ CodeBuild construye la imagen Docker y la sube a ECR
ğŸ“Œ **Archivo:** `pipeline/buildspec.yml`
- Instala dependencias con `pip install` en `src/`.
- Carga variables de entorno desde `config/dev.env`.
- Construye la imagen Docker (`docker build`).
- Se autentica en AWS ECR y sube la imagen.
- **Actualiza la Lambda** con la nueva imagen (`aws lambda update-function-code`).

### 4ï¸âƒ£ CloudFormation crea/actualiza la infraestructura
ğŸ“Œ **Archivo:** `cloudformation/infraestructura.yml`
- Crea el **ECR Repository** para la imagen.
- Crea el **IAM Role** para Lambda.
- Crea la **Lambda Function** usando la imagen de ECR.
- Configura **EventBridge** para ejecutar la Lambda cada minuto.

ğŸ’¡ **Nota:** Si los recursos ya existen, CloudFormation solo actualizarÃ¡ lo necesario.

### 5ï¸âƒ£ La Lambda se ejecuta automÃ¡ticamente
ğŸ“Œ **Servicio:** AWS Lambda
- La Lambda ya estÃ¡ actualizada con la nueva imagen de **ECR**.
- **EventBridge** la ejecuta automÃ¡ticamente cada 1 minuto.
- La Lambda obtiene secretos de **Secrets Manager** y sube archivos a **S3**.

## ğŸ”¹ ğŸ“Œ Resumen del Flujo Completo
1ï¸âƒ£ **GitHub â†’ CodePipeline** (Detecta cambios en `main`).
2ï¸âƒ£ **CodePipeline â†’ CodeBuild** (`buildspec.yml` instala dependencias, crea imagen y la sube a ECR).
3ï¸âƒ£ **CodePipeline â†’ CloudFormation** (`infraestructura.yml` crea/actualiza recursos como Lambda y EventBridge).
4ï¸âƒ£ **Lambda ejecuta el cÃ³digo y sube archivos a S3**.

---

âœ… **Con este flujo, los cambios en el cÃ³digo se despliegan automÃ¡ticamente en AWS.** ğŸ¯
